<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico Avanzado - GDevelop</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #0a1628;
            color: white;
            font-family: Arial, sans-serif;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            color: #ffd700;
            text-align: center;
        }
        
        .section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 2px solid #ffd700;
        }
        
        .error {
            background: rgba(255, 0, 0, 0.2);
            border-color: #f00;
        }
        
        .success {
            background: rgba(0, 255, 0, 0.2);
            border-color: #0f0;
        }
        
        .warning {
            background: rgba(255, 215, 0, 0.2);
            border-color: #ffd700;
        }
        
        iframe {
            width: 100%;
            height: 600px;
            background: #000;
            border: 2px solid #ffd700;
        }
        
        pre {
            background: #000;
            color: #0f0;
            padding: 15px;
            overflow-x: auto;
            font-size: 12px;
            border: 1px solid #ffd700;
        }
        
        button {
            background: #ffd700;
            color: #0a1628;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #ffed4e;
        }
        
        .file-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .file-item {
            padding: 5px;
            margin: 2px 0;
            background: rgba(0, 0, 0, 0.3);
        }
        
        .file-item.exists {
            color: #0f0;
        }
        
        .file-item.missing {
            color: #f00;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Diagn√≥stico Avanzado - GDevelop Game</h1>
        
        <div class="section">
            <h2>üìã Resumen del Problema</h2>
            <p>El archivo <code>game/index.html</code> se carga correctamente (507 caracteres), pero el juego no se muestra.</p>
            <p><strong>Posibles causas:</strong></p>
            <ul>
                <li>Faltan archivos JavaScript del juego (code0.js, code1.js, etc.)</li>
                <li>Faltan recursos (im√°genes, sonidos) en la carpeta assets/</li>
                <li>El juego necesita archivos de la carpeta libs/</li>
                <li>Hay errores de JavaScript que impiden la ejecuci√≥n</li>
            </ul>
        </div>

        <div class="section">
            <h2>üéÆ Visor del Juego</h2>
            <iframe 
                id="gameFrame" 
                src="game/index.html"
                title="Game"
                allowfullscreen
                allow="autoplay; gamepad; microphone; camera">
            </iframe>
            <button onclick="checkIframeErrors()">üîç Revisar Errores del Iframe</button>
        </div>

        <div class="section" id="errorSection" style="display: none;">
            <h2>‚ö†Ô∏è Errores Detectados en la Consola del Juego</h2>
            <pre id="iframeErrors"></pre>
        </div>

        <div class="section">
            <h2>üìÅ Archivos Requeridos por GDevelop</h2>
            <p>Verificando si los archivos necesarios existen...</p>
            <button onclick="checkFiles()">üîÑ Verificar Archivos</button>
            <div id="fileChecks" class="file-list"></div>
        </div>

        <div class="section">
            <h2>üìù Contenido de game/index.html</h2>
            <button onclick="fetchIndexContent()">Ver Contenido</button>
            <pre id="indexContent"></pre>
        </div>

        <div class="section warning">
            <h2>‚úÖ Soluciones Recomendadas</h2>
            <ol>
                <li><strong>Verifica que TODOS los archivos est√©n en GitHub:</strong>
                    <ul>
                        <li>game/index.html ‚úì</li>
                        <li>game/code0.js, code1.js, code2.js, etc.</li>
                        <li>game/libs/ (carpeta completa)</li>
                        <li>game/assets/ (carpeta completa con im√°genes/sonidos)</li>
                    </ul>
                </li>
                <li><strong>Si falta alg√∫n archivo:</strong> S√∫belo a GitHub en la misma estructura</li>
                <li><strong>Si todos los archivos est√°n:</strong> Verifica la consola del navegador (F12) para ver errores de JavaScript</li>
            </ol>
        </div>
    </div>

    <script>
        const commonFiles = [
            'game/index.html',
            'game/code0.js',
            'game/code1.js',
            'game/code2.js',
            'game/code3.js',
            'game/code4.js',
            'game/libs/pixi.js',
            'game/libs/jshashtable.js',
            'game/gd.js',
            'game/gdjshotreloader.js',
            'game/gdjs-evtsext__gamepads__gamepads.js'
        ];

        async function checkFiles() {
            const fileChecksDiv = document.getElementById('fileChecks');
            fileChecksDiv.innerHTML = '<p>Verificando archivos...</p>';
            
            const results = [];
            
            for (const file of commonFiles) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    const exists = response.ok;
                    results.push({
                        file: file,
                        exists: exists,
                        status: response.status
                    });
                } catch (error) {
                    results.push({
                        file: file,
                        exists: false,
                        status: 'ERROR'
                    });
                }
            }
            
            let html = '';
            let missingFiles = 0;
            
            results.forEach(result => {
                const className = result.exists ? 'exists' : 'missing';
                const icon = result.exists ? '‚úÖ' : '‚ùå';
                html += `<div class="file-item ${className}">${icon} ${result.file} (${result.status})</div>`;
                if (!result.exists) missingFiles++;
            });
            
            if (missingFiles > 0) {
                html = `<p style="color: #f00;">‚ö†Ô∏è Faltan ${missingFiles} archivos importantes!</p>` + html;
            } else {
                html = `<p style="color: #0f0;">‚úÖ Todos los archivos comunes fueron encontrados</p>` + html;
            }
            
            fileChecksDiv.innerHTML = html;
        }

        async function fetchIndexContent() {
            const indexContentPre = document.getElementById('indexContent');
            indexContentPre.textContent = 'Cargando...';
            
            try {
                const response = await fetch('game/index.html');
                const content = await response.text();
                indexContentPre.textContent = content;
            } catch (error) {
                indexContentPre.textContent = 'Error: ' + error.message;
            }
        }

        function checkIframeErrors() {
            const gameFrame = document.getElementById('gameFrame');
            const errorSection = document.getElementById('errorSection');
            const iframeErrors = document.getElementById('iframeErrors');
            
            try {
                const iframeWindow = gameFrame.contentWindow;
                const iframeConsole = [];
                
                // Intentar capturar errores del iframe
                errorSection.style.display = 'block';
                iframeErrors.textContent = 'Revisando errores...\n\n';
                
                // Verificar si hay errores en la consola
                setTimeout(() => {
                    iframeErrors.textContent += 'Para ver errores detallados:\n';
                    iframeErrors.textContent += '1. Abre la Consola del Navegador (F12)\n';
                    iframeErrors.textContent += '2. Ve a la pesta√±a "Console"\n';
                    iframeErrors.textContent += '3. Busca errores en rojo que mencionen "game/" o archivos .js\n\n';
                    iframeErrors.textContent += 'Los errores m√°s comunes son:\n';
                    iframeErrors.textContent += '- "Failed to load resource" ‚Üí Falta un archivo\n';
                    iframeErrors.textContent += '- "Uncaught ReferenceError" ‚Üí Falta un script de GDevelop\n';
                    iframeErrors.textContent += '- "NetworkError" ‚Üí El archivo no est√° en GitHub\n';
                }, 1000);
                
            } catch (e) {
                iframeErrors.textContent = 'No se puede acceder directamente al iframe debido a restricciones de seguridad.\n\n';
                iframeErrors.textContent += 'Abre la Consola del Navegador (F12) para ver los errores.';
            }
        }

        // Auto-verificar archivos al cargar
        window.addEventListener('load', function() {
            setTimeout(checkFiles, 1000);
        });

        // Capturar errores globales
        window.addEventListener('error', function(e) {
            console.error('Error detectado:', e.message);
        });
    </script>
</body>
</html>
